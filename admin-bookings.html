<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Bookings | The Pearl Vista</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { background: #fff; font-family: 'Lato', Arial, sans-serif; margin: 0; color: #101a2b; }
    .admin-dashboard { display: flex; min-height: 100vh; }
    .sidebar { background: #101a2b; color: #fff; width: 220px; padding: 2rem 1rem 1rem 1rem; display: flex; flex-direction: column; gap: 2rem; min-height: 100vh; }
    .sidebar nav { display: flex; flex-direction: column; gap: 1rem; }
    .sidebar nav a { color: #fff; text-decoration: none; padding: 0.7rem 1rem; border-radius: 8px; font-weight: 600; transition: background 0.2s; }
    .sidebar nav a.active, .sidebar nav a:hover { background: #767676; color: #fff; }
    .main-content { flex: 1; padding: 2rem 3rem; display: flex; flex-direction: column; gap: 2rem; background: #fff; min-height: 100vh; }
    header { width:100%; text-align:center; margin-bottom:1.2rem; background: #fff; }
    h2 { font-size:1.5rem; font-weight:600; color:#101a2b; letter-spacing:0.5px; margin:0; }
    .admin-profile { 
      position: fixed; 
      top: 32px; 
      right: 48px; 
      z-index: 1000; 
      display: flex; 
      align-items: center; 
      gap: 0.8rem; 
      color: #101a2b; 
      cursor: pointer; 
      transition: all 0.2s ease;
    }
    .admin-profile:hover { 
      transform: translateY(-1px);
    }
    .admin-profile .avatar { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      background: #FFD700; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: bold; 
      color: #101a2b; 
      font-size: 1.3rem;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
      transition: all 0.2s ease;
    }
    .admin-profile:hover .avatar {
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
      transform: scale(1.05);
    }
    #adminDropdown { 
      display: none; 
      position: absolute; 
      top: 52px; 
      right: 0; 
      background: #fff; 
      color: #101a2b; 
      border-radius: 16px; 
      box-shadow: 0 8px 32px rgba(0,0,0,0.12); 
      min-width: 240px; 
      padding: 1.8rem; 
      font-size: 0.95rem;
      border: 1px solid #f8f9fa;
      animation: dropdownFadeIn 0.3s ease;
      backdrop-filter: blur(10px);
    }
    @keyframes dropdownFadeIn {
      from { opacity: 0; transform: translateY(-15px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    #adminDropdown .user-info {
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: 1.2rem;
      margin-bottom: 1.2rem;
      position: relative;
    }
    #adminDropdown .user-info::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #FFD700, transparent);
    }
    #adminDropdown .user-name {
      font-weight: 700; 
      font-size: 1.2rem;
      margin-bottom: 0.4rem;
      color: #101a2b;
      letter-spacing: 0.5px;
    }
    #adminDropdown .user-email {
      font-size: 0.9rem; 
      margin-bottom: 0.8rem; 
      color: #666;
      font-weight: 500;
    }
    #adminDropdown .user-detail {
      font-size: 0.85rem; 
      margin-bottom: 0.4rem; 
      color: #666;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    #adminDropdown .user-detail i {
      width: 14px;
      color: #FFD700;
      font-size: 0.8rem;
    }
    #adminDropdown .user-detail span {
      color: #101a2b;
      font-weight: 600;
    }
    #adminDropdown .dropdown-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }
    #adminDropdown button { 
      padding: 0.8rem 1.2rem; 
      border-radius: 10px; 
      font-weight: 600; 
      cursor: pointer; 
      width: 100%; 
      font-size: 0.9rem;
      transition: all 0.3s ease;
      border: none;
      position: relative;
      overflow: hidden;
      margin-bottom: 0;
    }
    #adminDropdown button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    #adminDropdown button:hover::before {
      left: 100%;
    }
    #adminDropdown button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #adminDropdown .btn-profile {
      background: linear-gradient(135deg, #101a2b, #1a2332); 
      color: #FFD700;
      box-shadow: 0 2px 8px rgba(16, 26, 43, 0.2);
    }
    #adminDropdown .btn-settings {
      background: #fff; 
      color: #101a2b; 
      border: 2px solid #101a2b;
      box-shadow: 0 2px 8px rgba(16, 26, 43, 0.1);
    }
    #adminDropdown .btn-logout {
      background: linear-gradient(135deg, #FFD700, #FFA500); 
      color: #101a2b;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
    }
    .bookings-table { background: #101a2b; color: #FFD700; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); padding: 1rem 1.2rem; min-width: 350px; }
    .bookings-table table { width: 100%; border-collapse: collapse; }
    .bookings-table th, .bookings-table td { padding: 0.7rem 0.5rem; text-align: left; border-bottom: 1px solid #222; }
    .bookings-table th { color: #FFD700; font-size: 1rem; font-weight: 700; }
    .bookings-table td { font-size: 1rem; color: #fff; }
    .status { padding: 0.2em 0.8em; border-radius: 12px; font-size: 0.95em; font-weight: 600; display: inline-block; }
    .status.Confirmed { background: #e6f7e6; color: #1a7f37; }
    .status.Pending { background: #fffbe6; color: #b59f00; }
    .status.Checked-In { background: #1976d2; color: #fff; box-shadow: 0 2px 8px rgba(25,118,210,0.15); font-weight: 800; }
    .status.Checked-Out { background: #8e24aa; color: #fff; box-shadow: 0 2px 8px rgba(142,36,170,0.15); font-weight: 800; }
    .status.Cancelled { background: #ffeaea; color: #d32f2f; }
    .payment {
      display: inline-block;
      padding: 0.3em 1.1em;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1em;
      color: #fff;
      letter-spacing: 0.5px;
    }
    .payment.paid { background: #1a7f37; }
    .payment.pending { background: #FFD700; color: #101a2b; }
    .payment.failed { background: #d32f2f; }
    .center-dash { text-align: center; color: #888; font-size: 1.1em; font-weight: 600; }
    .customer-popup {
      display: none;
      position: fixed;
      z-index: 9999;
      background: #fff;
      color: #101a2b;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.18);
      padding: 1.2em 1.5em;
      min-width: 270px;
      max-width: 350px;
      font-size: 1rem;
      font-family: 'Lato', Arial, sans-serif;
      pointer-events: none;
    }
    .customer-popup strong { color: #FFD700; font-weight: 700; }
    .customer-popup .popup-label { color: #767676; font-size: 0.97em; font-weight: 600; }
    .customer-popup .popup-value { color: #101a2b; font-size: 1em; font-weight: 600; }
    .customer-popup .popup-row { margin-bottom: 0.5em; }
    .modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.35);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    .modal {
      background: #fff;
      color: #101a2b;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      padding: 2em 2.5em 1.5em 2.5em;
      min-width: 340px;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      font-family: 'Lato', Arial, sans-serif;
      position: relative;
      scrollbar-width: none; /* Firefox */
    }
    .modal::-webkit-scrollbar { display: none; }
    .modal h3 { margin-top: 0; color: #FFD700; font-size: 1.3em; }
    .modal label { font-weight: 600; margin-top: 1em; display: block; }
    .modal input, .modal select, .modal textarea {
      width: 100%; padding: 0.5em; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 1em; font-size: 1em;
    }
    .modal .modal-actions { display: flex; gap: 1em; margin-top: 1em; }
    .modal .modal-actions button { flex: 1; }
    .modal .close-btn {
      position: absolute; top: 1em; right: 1em; background: none; border: none; font-size: 1.3em; cursor: pointer;
      outline: none;
      box-shadow: none;
      border-radius: 0;
      padding: 0;
      transition: none;
    }
    .modal .close-btn:hover,
    .modal .close-btn:focus,
    .modal .close-btn:active {
      background: none !important;
      border: none !important;
      color: inherit !important;
      box-shadow: none !important;
      outline: none !important;
    }
    .modal .cancelled-label { color: #d32f2f; font-weight: 700; margin-bottom: 1em; }
  </style>
</head>
<body>
  <div class="admin-dashboard">
    <aside class="sidebar">
      <nav>
        <a href="admin-dashboard.html">Dashboard</a>
        <a href="admin-rooms.html">Rooms</a>
        <a href="admin-services.html">Services</a>
        <a href="admin-bookings.html" class="active">Bookings</a>
        <a href="admin-tour-bookings.html">Tour Bookings</a>
        <a href="admin-customers.html">Customers</a>
        <a href="admin-reports.html">Reports</a>
      </nav>
    </aside>
    <main class="main-content">
      <header>
        <h2>Welcome To The Pearl Vista</h2>
      </header>
      <div style="max-width: 900px; margin: 0 auto 1.5em auto; display: flex; justify-content: space-between; align-items: center; gap: 1em;">
        <button style="background:#FFD700; color:#101a2b; border:none; border-radius:8px; padding:0.7em 2em; font-weight:700; font-size:1rem; cursor:pointer; transition:background 0.2s; margin-right:1em;" onclick="openManageModal()">Manage Bookings</button>
        <select id="statusFilter" style="padding: 0.7em 1.2em; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; color: #555;" onchange="filterBookings()">
          <option value="">All Statuses</option>
          <option value="Confirmed">Confirmed</option>
          <option value="Pending">Pending</option>
          <option value="Cancelled">Cancelled</option>
          <option value="Checked-In">Checked-In</option>
          <option value="Checked-Out">Checked-Out</option>
        </select>
        <input id="bookingSearch" type="text" placeholder="Search bookings..." style="width: 320px; padding: 0.7em 1.2em; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;" oninput="filterBookings()" />
      </div>
      <div class="admin-profile" id="adminProfile">
        <span>Admin</span>
        <div class="avatar">A</div>
        <div id="adminDropdown">
          <div class="user-info">
            <div class="user-name">Admin</div>
            <div class="user-email">admin@pearlvista.com</div>
            <div class="user-detail">
              <i class="fas fa-building"></i>
              Department: <span>Management</span>
            </div>
            <div class="user-detail">
              <i class="fas fa-phone"></i>
              Phone: <span>+1 234 567 8901</span>
            </div>
            <div class="user-detail">
              <i class="fas fa-clock"></i>
              Last login: <span>23 Jul 2025, 14:44</span>
            </div>
          </div>
          <div class="dropdown-buttons">
            <button class="btn-profile" onclick="window.location.href='admin-profile.html'">Profile</button>
            <button class="btn-settings" onclick="window.location.href='admin-settings.html'">Settings</button>
            <button class="btn-logout" onclick="logoutAdmin()">Logout</button>
          </div>
        </div>
      </div>
      <h1 style="font-size:1.3rem; font-weight:600; color: #101a2b; margin-bottom:1rem;">All Bookings</h1>
      <div class="bookings-table">
        <div id="loadingMessage" style="text-align: center; padding: 2rem; color: #FFD700; font-size: 1.1rem;">
          <i class="fas fa-spinner fa-spin"></i> Loading bookings...
        </div>
        <table id="bookingsTable" style="display: none;">
          <thead>
            <tr>
              <th>Booking ID</th>
              <th>Customer</th>
              <th>Room</th>
              <th>Room Number</th>
              <th>Check-in</th>
              <th>Check-out</th>
              <th>Total Amount</th>
              <th>Payment Status</th>
              <th>Booking Status</th>
            </tr>
          </thead>
          <tbody id="bookingsTableBody">
            <!-- Dynamic content will be loaded here -->
          </tbody>
        </table>
        <div id="noBookingsMessage" style="text-align: center; padding: 2rem; color: #FFD700; font-size: 1.1rem; display: none;">
          <i class="fas fa-info-circle"></i> No bookings found
        </div>
      </div>
      <div id="customerPopup" class="customer-popup"></div>
    </main>
    <div id="manageModalBg" class="modal-bg">
      <div class="modal" id="manageModal">
        <button class="close-btn" onclick="closeManageModal()">&times;</button>
        <h3>Manage Booking</h3>
        <label for="manageBookingSelect">Select Booking</label>
        <select id="manageBookingSelect" onchange="loadBookingDetails()">
          <option value="">-- Select --</option>
        </select>
        <form id="manageBookingForm" style="display:none;">
          <label>Name</label>
          <input type="text" id="manageName" required />
          <label>Email</label>
          <input type="email" id="manageEmail" required />
          <label>Age</label>
          <input type="number" id="manageAge" min="0" required />
          <label>Guests</label>
          <input type="text" id="manageGuests" required />
          <label>Room Type</label>
          <select id="manageRoomType" required>
            <option value="Pearl Signature Room">Pearl Signature Room</option>
            <option value="Deluxe Room">Deluxe Room</option>
            <option value="Premium Room">Premium Room</option>
            <option value="Executive Room">Executive Room</option>
            <option value="Luxury Suite">Luxury Suite</option>
            <option value="Family Suite">Family Suite</option>
          </select>
          <label>Room Number</label>
          <input type="text" id="manageRoomNumber" required />
          <label>Check-in</label>
          <input type="date" id="manageCheckin" required />
          <label>Check-out</label>
          <input type="date" id="manageCheckout" required />
          <label>Payment Status</label>
          <select id="managePayment" required>
            <option value="Paid">Paid</option>
            <option value="Pending">Pending</option>
            <option value="Failed">Failed</option>
          </select>
          <label>Booking Status</label>
          <select id="manageStatus" required>
            <option value="Confirmed">Confirmed</option>
            <option value="Pending">Pending</option>
            <option value="Checked-In">Checked-In</option>
            <option value="Checked-Out">Checked-Out</option>
            <option value="Cancelled">Cancelled</option>
          </select>
          <label>No. of Rooms</label>
          <input type="number" id="manageNoOfRooms" min="1" required />
          <label>Special Requests</label>
          <textarea id="manageSpecial" rows="2"></textarea>
          <div class="modal-actions">
            <button type="button" class="action-btn" onclick="saveBookingDetails()">Save Changes</button>
            <button type="button" class="action-btn" style="background:#d32f2f; color:#fff;" onclick="cancelBookingAction()">Cancel Booking</button>
          </div>
          <div id="cancelledLabel" class="cancelled-label" style="display:none;">Booking Cancelled</div>
        </form>
      </div>
    </div>
  </div>
  <script>
    // Admin Dropdown Functionality
    document.addEventListener('DOMContentLoaded', function() {
      const adminProfile = document.getElementById('adminProfile');
      const adminDropdown = document.getElementById('adminDropdown');

      if (adminProfile && adminDropdown) {
        // Toggle dropdown on click
        adminProfile.addEventListener('click', function(e) {
          e.stopPropagation();
          const isVisible = adminDropdown.style.display === 'block';
          adminDropdown.style.display = isVisible ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          if (!adminProfile.contains(e.target)) {
            adminDropdown.style.display = 'none';
          }
        });

        // Prevent dropdown from closing when clicking inside it
        adminDropdown.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      }
    });

    // Logout function
    function logoutAdmin() {
      if (confirm('Are you sure you want to logout?')) {
        // Clear any admin session data
        localStorage.removeItem('admin_logged_in');
        localStorage.removeItem('admin_username');
        // Redirect to login page
        window.location.href = 'index.html';
      }
    }

    // Booking table search filter
    function filterBookings() {
      var input = document.getElementById('bookingSearch').value.toLowerCase();
      var status = document.getElementById('statusFilter').value;
      var table = document.querySelector('.bookings-table table');
      var rows = table.querySelectorAll('tbody tr');
      rows.forEach(function(row) {
        var text = row.textContent.toLowerCase();
        var statusText = row.querySelector('.status')?.textContent || '';
        var statusMatch = !status || statusText === status;
        var searchMatch = text.indexOf(input) > -1;
        if (statusMatch && searchMatch) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // Customer details data for popups
    const bookingDetails = [
      {
        name: 'John Smith', email: 'john.smith@email.com', phone: '+1 555 123 4567', age: 34, guests: '2 (2 adults)', payment: 'Paid', checkin: '2025-07-20', checkout: '2025-07-23', status: 'Checked-In', special: 'Late check-in', room: 'Pearl Signature Room', rooms: 1
      },
      {
        name: 'Jane Doe', email: 'jane.doe@email.com', phone: '+1 555 987 6543', age: 29, guests: '3 (2 adults, 1 kid)', payment: 'Pending', checkin: '2025-07-21', checkout: '2025-07-24', status: 'Pending', special: 'Extra pillows', room: 'Deluxe Room', rooms: 2
      },
      {
        name: 'Tom Fernton', email: 'tom.fernton@email.com', phone: '+1 555 222 3333', age: 41, guests: '1 (1 adult)', payment: 'Failed', checkin: '2025-07-22', checkout: '2025-07-25', status: 'Cancelled', special: '-', room: 'Premium Room', rooms: 1
      },
      {
        name: 'Emily Clark', email: 'emily.clark@email.com', phone: '+1 555 444 5555', age: 36, guests: '2 (2 adults)', payment: 'Paid', checkin: '2025-07-18', checkout: '2025-07-22', status: 'Confirmed', special: 'Airport pickup', room: 'Executive Room', rooms: 1
      },
      {
        name: 'Michael Lee', email: 'michael.lee@email.com', phone: '+1 555 666 7777', age: 38, guests: '4 (2 adults, 2 kids)', payment: 'Paid', checkin: '2025-07-19', checkout: '2025-07-23', status: 'Confirmed', special: 'Birthday cake', room: 'Luxury Suite', rooms: 2
      },
      {
        name: 'Priya Patel', email: 'priya.patel@email.com', phone: '+1 555 888 9999', age: 32, guests: '3 (2 adults, 1 kid)', payment: 'Pending', checkin: '2025-07-20', checkout: '2025-07-24', status: 'Pending', special: 'Vegetarian meals', room: 'Family Suite', rooms: 1
      },
      {
        name: 'Sarah Johnson', email: 'sarah.johnson@email.com', phone: '+1 555 111 2222', age: 27, guests: '2 (2 adults)', payment: 'Paid', checkin: '2025-07-25', checkout: '2025-07-28', status: 'Confirmed', special: 'High floor', room: 'Deluxe Room', rooms: 1
      },
      {
        name: 'David Kim', email: 'david.kim@email.com', phone: '+1 555 333 4444', age: 30, guests: '1 (1 adult)', payment: 'Pending', checkin: '2025-07-26', checkout: '2025-07-29', status: 'Pending', special: 'Early check-in', room: 'Premium Room', rooms: 1
      },
      {
        name: 'Linda Martinez', email: 'linda.martinez@email.com', phone: '+1 555 555 6666', age: 45, guests: '4 (2 adults, 2 kids)', payment: 'Paid', checkin: '2025-07-27', checkout: '2025-07-30', status: 'Confirmed', special: 'Anniversary setup', room: 'Luxury Suite', rooms: 2
      },
      {
        name: 'Omar Farouk', email: 'omar.farouk@email.com', phone: '+1 555 777 8888', age: 40, guests: '2 (2 adults)', payment: 'Failed', checkin: '2025-07-28', checkout: '2025-07-31', status: 'Cancelled', special: 'Baby cot', room: 'Executive Room', rooms: 1
      },
      {
        name: 'Anna Petrova', email: 'anna.petrova@email.com', phone: '+1 555 999 0000', age: 35, guests: '5 (2 adults, 3 kids)', payment: 'Paid', checkin: '2025-07-29', checkout: '2025-08-01', status: 'Confirmed', special: 'Extra towels', room: 'Family Suite', rooms: 2
      },
      {
        name: 'Lucas Brown', email: 'lucas.brown@email.com', phone: '+1 555 123 7890', age: 28, guests: '2 (2 adults)', payment: 'Pending', checkin: '2025-07-30', checkout: '2025-08-02', status: 'Pending', special: '-', room: 'Pearl Signature Room', rooms: 1
      },
      {
        name: 'Maria Rossi', email: 'maria.rossi@email.com', phone: '+39 06 1234 5678', age: 42, guests: '3 (2 adults, 1 kid)', payment: 'Paid', checkin: '2025-07-10', checkout: '2025-07-15', status: 'Checked-Out', special: 'Late check-out', room: 'Luxury Suite', rooms: 2
      }
    ];

    // Attach hover events to table rows after DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      var rows = document.querySelectorAll('.bookings-table tbody tr');
      rows.forEach(function(row, idx) {
        row.addEventListener('click', function(e) {
          e.stopPropagation();
          var popup = document.getElementById('customerPopup');
          if (popup.style.display === 'block' && popup.dataset.row == idx) {
            hideCustomerPopup();
          } else {
            showCustomerPopup(e, bookingDetails[idx]);
            popup.dataset.row = idx;
          }
        });
      });
      document.addEventListener('click', function() {
        hideCustomerPopup();
      });
    });

    function showCustomerPopup(e, details) {
      var popup = document.getElementById('customerPopup');
      popup.innerHTML =
        '<div class="popup-row"><span class="popup-label">Name:</span> <span class="popup-value">' + details.name + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Email:</span> <span class="popup-value">' + details.email + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Phone:</span> <span class="popup-value">' + details.phone + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Age:</span> <span class="popup-value">' + details.age + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Guests:</span> <span class="popup-value">' + details.guests + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Payment Status:</span> <span class="popup-value">' + details.payment + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Check-in:</span> <span class="popup-value">' + details.checkin + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Check-out:</span> <span class="popup-value">' + details.checkout + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Booking Status:</span> <span class="popup-value">' + details.status + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Special Requests:</span> <span class="popup-value">' + (details.special && details.special !== '-' ? details.special : '-') + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">Room Type:</span> <span class="popup-value">' + details.room + '</span></div>' +
        '<div class="popup-row"><span class="popup-label">No. of Rooms:</span> <span class="popup-value">' + details.rooms + '</span></div>';
      popup.style.display = 'block';
      moveCustomerPopup(e);
    }
    function moveCustomerPopup(e) {
      var popup = document.getElementById('customerPopup');
      var popupWidth = popup.offsetWidth || 320;
      var popupHeight = popup.offsetHeight || 250;
      var x = e.clientX + 20;
      var y = e.clientY + 10;
      var viewportWidth = window.innerWidth;
      var viewportHeight = window.innerHeight;
      // If popup would overflow right, shift left
      if (x + popupWidth > viewportWidth - 10) {
        x = viewportWidth - popupWidth - 10;
      }
      // If popup would overflow bottom, show above cursor
      if (y + popupHeight > viewportHeight - 10) {
        y = e.clientY - popupHeight - 10;
        if (y < 0) y = 10;
      }
      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
    }
    function hideCustomerPopup() {
      var popup = document.getElementById('customerPopup');
      popup.style.display = 'none';
    }

    // Manage Bookings Modal Logic
    function openManageModal() {
      document.getElementById('manageModalBg').style.display = 'flex';
      var select = document.getElementById('manageBookingSelect');
      select.innerHTML = '<option value="">-- Select --</option>';
      bookingDetails.forEach(function(b, i) {
        select.innerHTML += '<option value="' + i + '">' + b.name + ' (' + b.room + ')</option>';
      });
      document.getElementById('manageBookingForm').style.display = 'none';
      document.getElementById('cancelledLabel').style.display = 'none';
    }
    function closeManageModal() {
      document.getElementById('manageModalBg').style.display = 'none';
    }
    function loadBookingDetails() {
      var idx = document.getElementById('manageBookingSelect').value;
      if (idx === '') {
        document.getElementById('manageBookingForm').style.display = 'none';
        return;
      }
      var b = bookingDetails[idx];
      document.getElementById('manageName').value = b.name;
      document.getElementById('manageEmail').value = b.email;
      document.getElementById('manageAge').value = b.age;
      document.getElementById('manageGuests').value = b.guests;
      document.getElementById('manageRoomType').value = b.room;
      document.getElementById('manageRoomNumber').value = document.querySelectorAll('.bookings-table tbody tr')[idx].children[3].textContent;
      document.getElementById('manageCheckin').value = b.checkin;
      document.getElementById('manageCheckout').value = b.checkout;
      document.getElementById('managePayment').value = b.payment;
      document.getElementById('manageStatus').value = b.status;
      document.getElementById('manageNoOfRooms').value = b.rooms;
      document.getElementById('manageSpecial').value = b.special && b.special !== '-' ? b.special : '';
      document.getElementById('manageBookingForm').style.display = '';
      document.getElementById('cancelledLabel').style.display = b.status === 'Cancelled' ? '' : 'none';
    }
    function saveBookingDetails() {
      var idx = document.getElementById('manageBookingSelect').value;
      if (idx === '') return;
      var b = bookingDetails[idx];
      b.name = document.getElementById('manageName').value;
      b.email = document.getElementById('manageEmail').value;
      b.age = document.getElementById('manageAge').value;
      b.guests = document.getElementById('manageGuests').value;
      b.special = document.getElementById('manageSpecial').value || '-';
      b.room = document.getElementById('manageRoomType').value;
      b.checkin = document.getElementById('manageCheckin').value;
      b.checkout = document.getElementById('manageCheckout').value;
      b.payment = document.getElementById('managePayment').value;
      b.status = document.getElementById('manageStatus').value;
      b.rooms = document.getElementById('manageNoOfRooms').value;
      // Update table row
      var row = document.querySelectorAll('.bookings-table tbody tr')[idx];
      row.children[1].textContent = b.name;
      row.children[2].textContent = b.room;
      row.children[3].textContent = document.getElementById('manageRoomNumber').value;
      row.children[4].textContent = b.checkin;
      row.children[5].textContent = b.checkout;
      // Payment status
      var payCell = row.children[6];
      payCell.textContent = b.payment;
      payCell.className = 'payment ' + b.payment.toLowerCase();
      // Booking status
      var statCell = row.children[7];
      statCell.textContent = b.status;
      statCell.className = 'status ' + b.status;
      closeManageModal();
    }
    function cancelBookingAction() {
      var idx = document.getElementById('manageBookingSelect').value;
      if (idx === '') return;
      if (!confirm('Are you sure you want to cancel this booking?')) return;
      var b = bookingDetails[idx];
      b.status = 'Cancelled';
      // Update table row
      var row = document.querySelectorAll('.bookings-table tbody tr')[idx];
      row.querySelector('.status')?.classList.remove('Confirmed', 'Pending', 'Checked-In', 'Checked-Out');
      row.querySelector('.status')?.classList.add('Cancelled');
      row.querySelector('.status').textContent = 'Cancelled';
      document.getElementById('cancelledLabel').style.display = '';
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>
</body>
</html> 